<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="optional_products" inherit_id="website_sale.product" customize_show="True" name="Show Optional Products">
        <xpath expr="//div[@id='product_full_description']" position="after">
            <t t-set="optional_products" t-value="product.optional_product_ids"/>
            <div class="container mt32" t-if="optional_products">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th colspan="5">
                                Available Options:
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="product.optional_product_ids" t-as="product">
                            <t t-set="combination" t-value="product._get_first_possible_combination(parent_combination)"/>
                            <t t-if="product._is_add_to_cart_possible(parent_combination)">

                                <t t-set="combination_info" t-value="product._get_combination_info(combination, add_qty=add_qty or 1, pricelist=pricelist)"/>
                                <t t-set="product_variant" t-value="product.env['product.product'].browse(combination_info['product_id'])"/>

                                <tr class="js_product">
                                    <td class="td-img">
                                        <input type="hidden" class="product_template_id" t-att-value="product.id"/>
                                        <input type="hidden" class="product_id" t-attf-name="optional-product-#{product.id}" t-att-value="product_variant.id"/>
                                        <img t-if="product_variant" t-att-src="'/web/image/product.product/%s/image_128' % product_variant.id"  class="variant_image" alt="Product Image"/>
                                        <img t-else="" t-att-src="'/web/image/product.template/%s/image_128' % product.id"  class="variant_image" alt="Product Image"/>
                                    </td>
                                    <td class='td-product_name' style="vertical-align: middle;" colspan="2">
                                        <div class="mb-3">
                                            <strong class="product-name product_display_name" t-esc="combination_info['display_name']"/>
                                            <div class="text-muted small" t-field="product.description_sale"/>
                                        </div>
                                        <t t-call="sale.variants">
                                            <t t-set="combination" t-value="product._get_first_possible_combination(parent_combination)"/>
                                        </t>
                                    </td>
                                    <td class="text-center td-qty d-none" style="vertical-align: middle;">
                                        <t t-call='sale_product_configurator.product_quantity_config' />
                                    </td>
                                    <td class="text-center td-price" style="vertical-align: middle;">
                                        <div t-attf-class="text-danger oe_default_price oe_optional oe_striked_price {{'' if combination_info['has_discounted_price'] else 'd-none'}}"
                                            t-esc="combination_info['list_price']"
                                            t-options='{
                                                "widget": "monetary",
                                                "display_currency": (pricelist or product).currency_id
                                            }'/>
                                        <div class="oe_price" style="white-space: nowrap;"
                                            t-esc="combination_info['price']"
                                            t-options='{
                                                "widget": "monetary",
                                                "display_currency": (pricelist or product).currency_id
                                            }'/>
                                    </td>
                                    <td class="text-center" style="vertical-align: middle;">
                                        <span class="js_raw_price d-none" t-esc="combination_info['price']" />
                                        <p class="css_not_available_msg alert alert-warning">Option not available</p>

                                        <a role="button" href="#" class="js_add_optional btn btn-primary btn-sm"><i class="fa fa-shopping-cart add-optionnal-item"></i> Add to cart</a>
                                        <span class="js_remove d-none">
                                            <a role="button" href="#" class="js_remove"><i class="fa fa-trash-o remove-optionnal-item"></i></a>
                                        </span>
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>
            </div>
        </xpath>
    </template>

</odoo>
